
# 需求

## 一、地图图层分类

1、地图中合计有风险源、隐患、问题、巡查、监控设备5种图层；
2、其中风险源有5中类型图标，风险等级分别为：低风险  low、一般风险  medium、较大风险  high、重大风险  critical、可忽略风险  ignore

3、隐患：一般事故隐患  01；重大事故隐患  02

4、设备状态：在线  01；离线  02；维修中  03

5、问题：01一般；02 重大

## 二、根据选中的单位，通过接口获取下面所有的地块数据画出地块，且在地块上面显示地块名称（地图缩放时，地块的名称不漂移，一直在地块上面）；地块中心点默认定位在选中的单位中心点；初始化是若有多个单位，则默认定位在第一个单位的中心点；地图默认11级，最低缩放层级不能小于10级，最大不能超过23级；业务表单如果是查看时，禁用单位选择列表，且单位默认根据数据保存时选择的单位默认选中，只有图层切换查看功能；所有的设备图层上的设备点位都可以点击播放监控视频（视频流地址需要通过接口获取）

## 三、图层功能

1、风险源
1.1、新增风险源时只有风险源、监控设备两种图层；其中风险源为为新增表单页面打点生成，可重新打点（只有一个风险源点位）；设备图层：根据选中的单位从设备数据接口中统一获取，会有多个设备点位，根据设备状态显示不同的图标，如果设备没有经纬度则不显示）
1.2、风险源修改、查看详情时会有：风险源、隐患、巡查、问题、设备5种图层，风险源图层固定只会有一个点位；隐患会有多个点位；问题也有多个点位；巡查图层切换时，会弹出一个下拉框，下拉框选择指定巡查计划，批量打点巡查计划的所有点位）；问题会有多个点位；设备会有多个点位）；图层切换时，地块一直显示，只是图层点位只显示选中图层相关的点位；

2、隐患
2.1、新增隐患时包含风险源、隐患、设备3种图层；风险源图层只会有一个点位；隐患图层只会有一个隐患点位，手动打点；监控设备点位和风险源的设备点位逻辑一致；
2.2、隐患修改、查看时，包含风险源、隐患、巡查计划、问题、设备5种点位；隐患修改时，可能会重新关联风险源，那么地图中的风险源点位会有变化；

3、巡查
1、多个点位显示，其中会有选择指定点位，该点位会高亮突出；同时实数据获取当前用户的轨迹经纬度（可按照10秒动态刷新人员在地图上的实时轨迹）；可根据传人的一组经纬度数据渲染轨迹图；可计算当前用户的实时定位经纬度和指定点位的经纬度的直线距离小于50米（距离后台配置），才可以执行打点或者上报操作；PC端会有图标序号显示，例1号点位，则图标上面显示1

4、工单
1、包含风险源、隐患、设备3种图层，默认选择设备图层；在设备图层时，在地图有一个选择按钮，点击选择，可批量选择设备点位，同时选择按钮的文案变为：确定；选中的设备图标变为变为另一种图标颜色，二次点击则取消选中；点击“确定”按钮；将选择的设备批量获取等我后在表单回显；若继续点击地图上的“选择”按钮，则已选择的设备图标默认变为已选中状态，可取消选中；

5、设备
根据选中的单位，加载设备点位集合，设备点位点击弹出播放图层，请求接口获取设备视频流地址，直接播放视频；视频播放框可放大到全屏；
